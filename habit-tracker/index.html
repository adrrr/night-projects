<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Habit Tracker</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--bg:#f2f2f7;--card:rgba(255,255,255,.72);--accent:#007aff;--red:#ff3b30;--green:#34c759;--text:#1c1c1e;--sub:#8e8e93;--border:rgba(0,0,0,.06)}
body{font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;padding:0 16px 100px}
h1{font-size:34px;font-weight:800;padding:60px 0 4px;letter-spacing:-.5px}
.subtitle{color:var(--sub);font-size:15px;margin-bottom:20px}
.card{background:var(--card);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:16px;border:1px solid var(--border);overflow:hidden;margin-bottom:12px}
.habit{display:flex;align-items:center;padding:14px 16px;gap:14px;transition:background .15s;position:relative}
.habit:active{background:rgba(0,0,0,.04)}
.habit+.habit{border-top:1px solid var(--border)}
.check{width:30px;height:30px;border-radius:50%;border:2.5px solid var(--sub);flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .3s cubic-bezier(.34,1.56,.64,1);cursor:pointer}
.check.done{border-color:var(--green);background:var(--green);transform:scale(1)}
.check.done svg{opacity:1;transform:scale(1)}
.check svg{width:16px;height:16px;opacity:0;transform:scale(.5);transition:all .3s cubic-bezier(.34,1.56,.64,1)}
.check.pop{animation:pop .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{0%{transform:scale(1)}40%{transform:scale(1.3)}100%{transform:scale(1)}}
.habit-info{flex:1;min-width:0}
.habit-name{font-size:17px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.habit-streak{font-size:13px;color:var(--sub);margin-top:2px}
.habit-streak span{color:var(--accent);font-weight:600}
.bars{display:flex;gap:3px;align-items:end;height:28px;margin-top:4px}
.bar{width:8px;border-radius:4px;background:var(--border);min-height:4px;transition:height .4s cubic-bezier(.34,1.56,.64,1),background .3s}
.bar.active{background:var(--accent)}
.bar.today{background:var(--green)}
.delete-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;color:var(--sub);cursor:pointer;flex-shrink:0;transition:all .2s}
.delete-btn:active{background:rgba(255,59,48,.1);color:var(--red)}
.add-area{position:fixed;bottom:0;left:0;right:0;padding:12px 16px;padding-bottom:max(12px,env(safe-area-inset-bottom));background:rgba(242,242,247,.8);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid var(--border)}
.add-row{display:flex;gap:10px}
.add-input{flex:1;height:50px;border-radius:14px;border:1px solid var(--border);padding:0 16px;font-size:17px;background:var(--card);backdrop-filter:blur(10px);outline:none;font-family:inherit;transition:border .2s}
.add-input:focus{border-color:var(--accent)}
.add-btn{height:50px;width:50px;border-radius:14px;border:none;background:var(--accent);color:#fff;font-size:24px;font-weight:300;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s,opacity .2s;flex-shrink:0}
.add-btn:active{transform:scale(.92)}
.empty{text-align:center;padding:60px 20px;color:var(--sub)}
.empty .icon{font-size:48px;margin-bottom:12px}
.empty p{font-size:15px;line-height:1.5}
.stats-section{margin-top:8px}
.stats-title{font-size:13px;font-weight:600;color:var(--sub);text-transform:uppercase;letter-spacing:.5px;padding:0 4px 8px}
.stats-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:20px}
.stat-card{background:var(--card);backdrop-filter:blur(20px);border-radius:14px;border:1px solid var(--border);padding:14px;text-align:center}
.stat-num{font-size:28px;font-weight:700;color:var(--accent)}
.stat-label{font-size:11px;color:var(--sub);margin-top:2px;text-transform:uppercase;letter-spacing:.3px}
.confetti{position:fixed;pointer-events:none;z-index:999}
.particle{position:absolute;width:8px;height:8px;border-radius:50%;animation:fall 1s cubic-bezier(.25,.46,.45,.94) forwards}
@keyframes fall{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--dx),var(--dy)) scale(0)}}
.days-row{display:flex;gap:3px;justify-content:center}
.day-label{width:8px;font-size:8px;text-align:center;color:var(--sub)}
</style>
</head>
<body>
<h1>Habits</h1>
<p class="subtitle" id="dateStr"></p>
<div id="stats"></div>
<div id="list"></div>
<div class="add-area">
<div class="add-row">
<input class="add-input" id="input" placeholder="Nouvelle habitude..." maxlength="40" enterkeyhint="done">
<button class="add-btn" id="addBtn" aria-label="Ajouter">+</button>
</div>
</div>
<script>
const $ = s => document.querySelector(s);
const KEY = 'habits_v2';
const today = () => new Date().toISOString().slice(0, 10);
const dayNames = ['D','L','M','M','J','V','S'];

function load() { try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch { return []; } }
function save(h) { localStorage.setItem(KEY, JSON.stringify(h)); }

function last7Days() {
  const days = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(); d.setDate(d.getDate() - i);
    days.push(d.toISOString().slice(0, 10));
  }
  return days;
}

function streak(habit) {
  let s = 0, d = new Date();
  if (!habit.done.includes(today())) return 0;
  while (true) {
    const ds = d.toISOString().slice(0, 10);
    if (habit.done.includes(ds)) { s++; d.setDate(d.getDate() - 1); }
    else break;
  }
  return s;
}

function bestStreak(habit) {
  if (!habit.done.length) return 0;
  const sorted = [...habit.done].sort();
  let best = 1, cur = 1;
  for (let i = 1; i < sorted.length; i++) {
    const prev = new Date(sorted[i-1]), curr = new Date(sorted[i]);
    const diff = (curr - prev) / 864e5;
    if (diff === 1) { cur++; best = Math.max(best, cur); }
    else if (diff > 1) cur = 1;
  }
  return best;
}

function confetti(x, y) {
  const c = document.createElement('div');
  c.className = 'confetti';
  c.style.left = x + 'px'; c.style.top = y + 'px';
  const colors = ['#ff3b30','#ff9500','#ffcc00','#34c759','#007aff','#af52de','#ff2d55'];
  for (let i = 0; i < 18; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const angle = (Math.PI * 2 * i) / 18 + (Math.random() - .5);
    const dist = 40 + Math.random() * 60;
    p.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
    p.style.setProperty('--dy', Math.sin(angle) * dist - 20 + 'px');
    p.style.background = colors[i % colors.length];
    p.style.width = (4 + Math.random() * 6) + 'px';
    p.style.height = p.style.width;
    p.style.animationDuration = (.6 + Math.random() * .5) + 's';
    c.appendChild(p);
  }
  document.body.appendChild(c);
  setTimeout(() => c.remove(), 1200);
}

function renderStats(habits) {
  const days = last7Days();
  const todayDone = habits.filter(h => h.done.includes(today())).length;
  const total = habits.length;
  const weekDone = habits.reduce((s, h) => s + days.filter(d => h.done.includes(d)).length, 0);
  const weekMax = total * 7;
  const best = habits.reduce((m, h) => Math.max(m, bestStreak(h)), 0);
  
  if (!total) { $('#stats').innerHTML = ''; return; }
  $('#stats').innerHTML = `
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-num">${todayDone}/${total}</div><div class="stat-label">Aujourd'hui</div></div>
      <div class="stat-card"><div class="stat-num">${weekMax ? Math.round(weekDone/weekMax*100) : 0}%</div><div class="stat-label">Semaine</div></div>
      <div class="stat-card"><div class="stat-num">${best}j</div><div class="stat-label">Best streak</div></div>
    </div>`;
}

function render() {
  const habits = load();
  const days = last7Days();
  const t = today();
  const d = new Date();
  $('#dateStr').textContent = d.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
  
  renderStats(habits);
  
  if (!habits.length) {
    $('#list').innerHTML = `<div class="card"><div class="empty"><div class="icon">âœ¨</div><p>Aucune habitude pour l'instant.<br>Ajoute-en une pour commencer !</p></div></div>`;
    return;
  }
  
  let html = '<div class="card">';
  habits.forEach((h, i) => {
    const done = h.done.includes(t);
    const s = streak(h);
    const barsHtml = days.map(day => {
      const isDone = h.done.includes(day);
      const isToday = day === t;
      return `<div class="bar ${isDone ? (isToday ? 'today' : 'active') : ''}" style="height:${isDone ? 28 : 4}px"></div>`;
    }).join('');
    const dayLabels = days.map(day => `<div class="day-label">${dayNames[new Date(day).getDay()]}</div>`).join('');
    
    html += `<div class="habit" data-i="${i}">
      <div class="check ${done ? 'done' : ''}" data-i="${i}">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 13l4 4L19 7"/></svg>
      </div>
      <div class="habit-info">
        <div class="habit-name">${h.name}</div>
        <div class="habit-streak">${s ? `ðŸ”¥ <span>${s} jour${s>1?'s':''}</span>` : 'Pas encore commencÃ©'}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;gap:2px">
        <div class="bars">${barsHtml}</div>
        <div class="days-row">${dayLabels}</div>
      </div>
      <div class="delete-btn" data-del="${i}">âœ•</div>
    </div>`;
  });
  html += '</div>';
  $('#list').innerHTML = html;
}

$('#list').addEventListener('click', e => {
  const check = e.target.closest('.check');
  if (check) {
    const i = +check.dataset.i;
    const habits = load();
    const t = today();
    const idx = habits[i].done.indexOf(t);
    if (idx === -1) {
      habits[i].done.push(t);
      check.classList.add('done', 'pop');
      const r = check.getBoundingClientRect();
      confetti(r.left + r.width/2, r.top + r.height/2);
      if (navigator.vibrate) navigator.vibrate(10);
    } else {
      habits[i].done.splice(idx, 1);
      check.classList.remove('done');
    }
    save(habits);
    setTimeout(render, 350);
    return;
  }
  const del = e.target.closest('.delete-btn');
  if (del) {
    const i = +del.dataset.del;
    const habits = load();
    if (confirm(`Supprimer "${habits[i].name}" ?`)) {
      habits.splice(i, 1);
      save(habits);
      render();
    }
  }
});

function addHabit() {
  const v = $('#input').value.trim();
  if (!v) return;
  const habits = load();
  habits.push({ name: v, done: [], created: today() });
  save(habits);
  $('#input').value = '';
  render();
  if (navigator.vibrate) navigator.vibrate(5);
}

$('#addBtn').addEventListener('click', addHabit);
$('#input').addEventListener('keydown', e => { if (e.key === 'Enter') addHabit(); });

render();
</script>
</body>
</html>